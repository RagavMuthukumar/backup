apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: prod-nginx
data:
  nginx.conf: |
    user  nginx;
    worker_processes auto;             # Automatically use available CPU cores

    events {                            # Controls connection handling
      worker_connections 1024;          # Max connections per worker
    }

    http {
      include       /etc/nginx/mime.types;           # File type mappings (html, css, js, etc.)
      default_type  application/octet-stream;        # Default file type if unknown

      sendfile        on;                              # Faster static file transfer
      keepalive_timeout 65;                           # Keep client connections alive for 65 seconds

      server {                 # NGINX listens on port 80
        listen 80;
        server_name _;         # Accept requests for any hostname

        location / {
          root /usr/share/nginx/html;   # Directory where website files exist
          index index.html;             # Default file served
        }

        location /health {              # Health endpoint for Kubernetes probes
          return 200 "OK";
        }
      }
    }
